/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package lk.ijse.moderntech.views;

import java.awt.Color;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;
import lk.ijse.moderntech.controler.RepairBillCotroller;
import lk.ijse.moderntech.model.RepairDetailModel;
import lk.ijse.moderntech.model.RepairModel;

/**
 *
 * @author Shamal
 */
public class RepairBill extends javax.swing.JInternalFrame {

    boolean state;

    /**
     * Creates new form RepairBill
     */
    public RepairBill(boolean state) {
        initComponents();
        ((javax.swing.plaf.basic.BasicInternalFrameUI) this.getUI()).setNorthPane(null);
        this.state = state;
        setTheam();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnlBack = new javax.swing.JPanel();
        lblRepairid = new javax.swing.JLabel();
        txtRepairid = new javax.swing.JTextField();
        lblRepairdescription = new javax.swing.JLabel();
        txtRepairdescription = new javax.swing.JTextField();
        lblPrice = new javax.swing.JLabel();
        txtPrice = new javax.swing.JTextField();
        lblServicecharge = new javax.swing.JLabel();
        txtServicecharge = new javax.swing.JTextField();
        btnClear = new keeptoo.KButton();
        btnPlaceorder = new keeptoo.KButton();
        lblTotal = new javax.swing.JLabel();
        lblTotalPrice = new javax.swing.JLabel();
        lblCash = new javax.swing.JLabel();
        lblBalancetext = new javax.swing.JLabel();
        lblBalance = new javax.swing.JLabel();
        txtCash = new javax.swing.JTextField();
        lblDiscount = new javax.swing.JLabel();
        txtDiscount = new javax.swing.JTextField();
        lblPriceservice = new javax.swing.JLabel();
        lblTot = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();

        setBorder(null);
        setPreferredSize(new java.awt.Dimension(1310, 820));

        pnlBack.setBackground(new java.awt.Color(255, 255, 255));
        pnlBack.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lblRepairid.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblRepairid.setText("Repair ID :");
        pnlBack.add(lblRepairid, new org.netbeans.lib.awtextra.AbsoluteConstraints(190, 60, -1, -1));

        txtRepairid.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        txtRepairid.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(0, 120, 215)));
        txtRepairid.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtRepairidActionPerformed(evt);
            }
        });
        pnlBack.add(txtRepairid, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 60, 320, -1));

        lblRepairdescription.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblRepairdescription.setText("Repair description :");
        pnlBack.add(lblRepairdescription, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 120, -1, -1));

        txtRepairdescription.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        txtRepairdescription.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(0, 120, 215)));
        pnlBack.add(txtRepairdescription, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 120, 900, -1));

        lblPrice.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblPrice.setText("Price :");
        pnlBack.add(lblPrice, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 200, -1, -1));

        txtPrice.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        txtPrice.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(0, 120, 215)));
        txtPrice.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtPriceActionPerformed(evt);
            }
        });
        txtPrice.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtPriceKeyReleased(evt);
            }
        });
        pnlBack.add(txtPrice, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 200, 320, -1));

        lblServicecharge.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblServicecharge.setText("Service charge :");
        pnlBack.add(lblServicecharge, new org.netbeans.lib.awtextra.AbsoluteConstraints(720, 200, -1, -1));

        txtServicecharge.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        txtServicecharge.setText("500.00");
        txtServicecharge.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(0, 120, 215)));
        pnlBack.add(txtServicecharge, new org.netbeans.lib.awtextra.AbsoluteConstraints(870, 200, 320, -1));

        btnClear.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(255, 46, 50)));
        btnClear.setForeground(new java.awt.Color(255, 46, 50));
        btnClear.setText("Clear");
        btnClear.setFont(new java.awt.Font("Poppins", 1, 24)); // NOI18N
        btnClear.setkAllowGradient(false);
        btnClear.setkBackGroundColor(new java.awt.Color(255, 255, 255));
        btnClear.setkBorderRadius(0);
        btnClear.setkForeGround(new java.awt.Color(255, 46, 50));
        btnClear.setkHoverColor(new java.awt.Color(255, 46, 50));
        btnClear.setkHoverForeGround(new java.awt.Color(255, 255, 255));
        btnClear.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnClearActionPerformed(evt);
            }
        });
        pnlBack.add(btnClear, new org.netbeans.lib.awtextra.AbsoluteConstraints(810, 620, -1, -1));

        btnPlaceorder.setBorder(null);
        btnPlaceorder.setText("Place Order");
        btnPlaceorder.setFont(new java.awt.Font("Poppins", 1, 24)); // NOI18N
        btnPlaceorder.setkAllowGradient(false);
        btnPlaceorder.setkBackGroundColor(new java.awt.Color(0, 120, 215));
        btnPlaceorder.setkBorderRadius(0);
        btnPlaceorder.setkHoverColor(new java.awt.Color(0, 80, 143));
        btnPlaceorder.setkHoverForeGround(new java.awt.Color(255, 255, 255));
        btnPlaceorder.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPlaceorderActionPerformed(evt);
            }
        });
        pnlBack.add(btnPlaceorder, new org.netbeans.lib.awtextra.AbsoluteConstraints(1010, 620, -1, -1));

        lblTotal.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblTotal.setText("Total :");
        pnlBack.add(lblTotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(810, 370, -1, -1));

        lblTotalPrice.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblTotalPrice.setText("0");
        pnlBack.add(lblTotalPrice, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 280, -1, -1));

        lblCash.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblCash.setText("Cash :");
        pnlBack.add(lblCash, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 530, -1, -1));

        lblBalancetext.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblBalancetext.setText("Balance :");
        pnlBack.add(lblBalancetext, new org.netbeans.lib.awtextra.AbsoluteConstraints(780, 540, -1, -1));

        lblBalance.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblBalance.setText("0");
        pnlBack.add(lblBalance, new org.netbeans.lib.awtextra.AbsoluteConstraints(880, 540, -1, -1));

        txtCash.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        txtCash.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(0, 120, 215)));
        txtCash.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtCashKeyReleased(evt);
            }
        });
        pnlBack.add(txtCash, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 530, 320, -1));

        lblDiscount.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblDiscount.setText("Discount :");
        pnlBack.add(lblDiscount, new org.netbeans.lib.awtextra.AbsoluteConstraints(190, 360, -1, -1));

        txtDiscount.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        txtDiscount.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(0, 120, 215)));
        txtDiscount.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtDiscountKeyReleased(evt);
            }
        });
        pnlBack.add(txtDiscount, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 370, 320, -1));

        lblPriceservice.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblPriceservice.setText("Price + service charge :");
        pnlBack.add(lblPriceservice, new org.netbeans.lib.awtextra.AbsoluteConstraints(80, 280, -1, -1));

        lblTot.setFont(new java.awt.Font("Poppins", 0, 18)); // NOI18N
        lblTot.setText("0");
        pnlBack.add(lblTot, new org.netbeans.lib.awtextra.AbsoluteConstraints(880, 370, -1, -1));
        pnlBack.add(jSeparator1, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 470, 1270, 10));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlBack, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlBack, javax.swing.GroupLayout.DEFAULT_SIZE, 797, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnClearActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnClearActionPerformed
        txtPrice.setText("");
        txtRepairdescription.setText("");
        txtRepairid.setText("");
        lblTotalPrice.setText(".");
    }//GEN-LAST:event_btnClearActionPerformed

    private void txtRepairidActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtRepairidActionPerformed
        try {
            RepairModel repair = new RepairBillCotroller().getRepair(txtRepairid.getText());
            txtRepairid.setText(repair.getRepairID());
            txtRepairdescription.setText(repair.getRepairDescription());
            txtPrice.setText(repair.getPrice());

            try {
                if (txtPrice.getText().trim().length() > 0) {
                    double price = Double.valueOf(txtPrice.getText());
                    double service = Double.valueOf(txtServicecharge.getText());
                    lblTotalPrice.setText(String.valueOf(price + service));
                }else{
                    new InformationBox(new javax.swing.JFrame(), true, "No price found!").setVisible(true);
                }
            } finally {

            }
        } catch (ClassNotFoundException ex) {
            new ErrorBox(new javax.swing.JFrame(), true, "Class not found exception").setVisible(true);
        } catch (SQLException ex) {
            new ErrorBox(new javax.swing.JFrame(), true, "Sql exception").setVisible(true);
        }
    }//GEN-LAST:event_txtRepairidActionPerformed

    private void btnPlaceorderActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPlaceorderActionPerformed
        RepairModel model = new RepairModel();
        model.setRepairID(txtRepairid.getText());
        model.setRepairDescription(txtRepairdescription.getText());
        model.setPrice(lblTotalPrice.getText());
        model.setRepairStatus("Paid");

        RepairDetailModel detail = new RepairDetailModel(
                txtRepairid.getText(),
                null,
                lblTotalPrice.getText(),
                txtDiscount.getText(),
                lblTot.getText()
        );

        try {
            boolean saved = new RepairBillCotroller().addBill(model, detail);
            if (saved) {
                new InformationBox(new javax.swing.JFrame(), true, "Bill successfull").setVisible(true);
            } else {
                new InformationBox(new javax.swing.JFrame(), true, "Something went wrong, Try again.").setVisible(true);
            }
        } catch (ClassNotFoundException ex) {
            new ErrorBox(new javax.swing.JFrame(), true, "Class not found exception").setVisible(true);
        } catch (SQLException ex) {
            new ErrorBox(new javax.swing.JFrame(), true, "Sql exception").setVisible(true);
        }
    }//GEN-LAST:event_btnPlaceorderActionPerformed

    private void txtCashKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtCashKeyReleased
        if (txtCash.getText().matches("[0-9]*")) {
            try {
                double total = Double.valueOf(lblTot.getText());
                double cash = Double.valueOf(txtCash.getText());
                double balance = total - cash;
                lblBalance.setText(balance + "0");
            } finally {

            }
        } else {
            txtCash.setText(txtCash.getText().substring(0, txtCash.getText().length() - 1));
        }
    }//GEN-LAST:event_txtCashKeyReleased

    private void txtDiscountKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDiscountKeyReleased

        try {
            if (lblPriceservice.getText().trim().length() > 0 && txtDiscount.getText().trim().length() > 0) {
                double tot = Double.valueOf(lblTotalPrice.getText());
                double discount = Double.valueOf(txtDiscount.getText());
                lblTot.setText(String.valueOf(tot - discount));
            }
        } finally {

        }
    }//GEN-LAST:event_txtDiscountKeyReleased

    private void txtPriceKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtPriceKeyReleased

        try {
            double price = Double.valueOf(txtPrice.getText());
            double service = Double.valueOf(txtServicecharge.getText());
            lblTotalPrice.setText(String.valueOf(price + service));
            lblTot.setText(String.valueOf(price + service));
        } finally {

        }

    }//GEN-LAST:event_txtPriceKeyReleased

    private void txtPriceActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtPriceActionPerformed

        try {
            double price = Double.valueOf(txtPrice.getText());
            double service = Double.valueOf(txtServicecharge.getText());
            lblTotalPrice.setText(String.valueOf(price + service));
            lblTot.setText(String.valueOf(price + service));
        } finally {

        }
    }//GEN-LAST:event_txtPriceActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private keeptoo.KButton btnClear;
    private keeptoo.KButton btnPlaceorder;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JLabel lblBalance;
    private javax.swing.JLabel lblBalancetext;
    private javax.swing.JLabel lblCash;
    private javax.swing.JLabel lblDiscount;
    private javax.swing.JLabel lblPrice;
    private javax.swing.JLabel lblPriceservice;
    private javax.swing.JLabel lblRepairdescription;
    private javax.swing.JLabel lblRepairid;
    private javax.swing.JLabel lblServicecharge;
    private javax.swing.JLabel lblTot;
    private javax.swing.JLabel lblTotal;
    private javax.swing.JLabel lblTotalPrice;
    private javax.swing.JPanel pnlBack;
    private javax.swing.JTextField txtCash;
    private javax.swing.JTextField txtDiscount;
    private javax.swing.JTextField txtPrice;
    private javax.swing.JTextField txtRepairdescription;
    private javax.swing.JTextField txtRepairid;
    private javax.swing.JTextField txtServicecharge;
    // End of variables declaration//GEN-END:variables

    private void setTheam() {
        if (state) {
            pnlBack.setBackground(Color.BLACK);
            lblPrice.setForeground(Color.WHITE);
            lblRepairdescription.setForeground(Color.WHITE);
            lblRepairid.setForeground(Color.WHITE);
            lblServicecharge.setForeground(Color.WHITE);
            lblTotal.setForeground(Color.WHITE);
            lblTotalPrice.setForeground(Color.WHITE);
            lblDiscount.setForeground(Color.WHITE);
            txtDiscount.setForeground(Color.WHITE);
            txtPrice.setForeground(Color.WHITE);
            txtRepairdescription.setForeground(Color.WHITE);
            txtRepairid.setForeground(Color.WHITE);
            txtServicecharge.setForeground(Color.WHITE);
            txtPrice.setBackground(Color.BLACK);
            txtRepairdescription.setBackground(Color.BLACK);
            txtRepairid.setBackground(Color.BLACK);
            txtServicecharge.setBackground(Color.BLACK);
            txtDiscount.setBackground(Color.BLACK);
        } else {
        }
    }
}
